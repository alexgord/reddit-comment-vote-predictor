# Reddit Comment Vote Predictor

This is a small, simple tool written in Python that uses a neural network to attempt 
to learn to predict the votes for top-level comments for the more popular subreddits. 
I have chosen to train the neural network on comments from the following subreddits: 
todayilearned, worldnews, science, pics, gaming, IAmA, videos.

## Requirements

This tool was developed using TensorFlow 2.1 and uses Flask to run the web server.

## Setup

Make sure you have an app registered with reddit and you create the file `settings\app.json`

with the following content:

```json
{
    "app_id" : "<app id here>",
    "secret" : "<app secret here>"
}
```

Next, make sure you have Python, TensorFlow 2.1, and the necessary CUDA drivers installed.

## Usage

### Scripts and functions

To scrape data from Reddit to get your own data to train the neural network with, 
run the `queryreddit.py` script to gather the data that trains the neural network 
that predicts the votes a comment will get, and run `getsciencedata.py` to gather 
the data that trains the neural network that predicts if a comment would be 
removed from /r/science.

To create, train, and save the neural network using this data, run the `trainmodel.py`, 
the `trainmodelgenerative.py`, and the `trainsciencemodel.py` scripts.

To test all the neural networks and see some sample predictions, run 
the `testmodels.py` script.

### REST API

There is a REST API available that offers a variety of features, described below.

#### Predict the votes a comment would get

The URL to access this feature is `http://www.votepredictor.com/api/predict`. 
The API expects a POST request with JSON data containing the following fields:

* time: The unix time in seconds since the Unix epoch
* title: The title of the post you are commenting on
* text: The comment itself
* subreddit: An integer between 1 and 7 representing which of the subreddits the comment will be 
posted to. In order from 1 to 7, the subreddits are: todayilearned, worldnews, science, pics, gaming, IAmA, videos.

The API will then respond with a JSON object containing a `prediction` field, which will have an 
integer representing the votes the neural network predicts this comment will have.

Here is an example CURL command that requests a prediction: 

```bash
curl -X POST http://www.votepredictor.com/api/predict
--data "{\"time\": 1563314096, \"title\": \"some title\", \"text\": \"some text\", \"subreddit\": 1}"
--header "Content-Type: application/json"
```

Here is an example response to a request like the one above:

```json
{
    "prediction":7
}
```

#### Predict the votes a comment would get over 24 hours

Similarly, `http://www.votepredictor.com/api/predict/day` can be used in the exact same way to return 
the predictions over the next 24 hours. The request would be the same as when requesting the prediction 
of the votes of a comment, as described above, but the response will contain a list of predictions for every 30 minutes over 
the next 24 hours after the specified time. Here is an example response:

```json
{
    "predictions": [7,12,7,11,7,20,20,20,20,20,20,20,20,19,20,19,20,18,19,
                    17,19,15,18,14,18,14,17,14,16,13,15,13,14,13,13,13,11,
                    13,10,12,9,12,8,12,7,12,7,12],
    "times": [1563314096,1563315896,1563317696,1563319496,1563321296,1563323096,
                1563324896,1563326696,1563328496,1563330296,1563332096,1563333896,
                1563335696,1563337496,1563339296,1563341096,1563342896,1563344696,
                1563346496,1563348296,1563350096,1563351896,1563353696,1563355496,
                1563357296,1563359096,1563360896,1563362696,1563364496,1563366296,
                1563368096,1563369896,1563371696,1563373496,1563375296,1563377096,
                1563378896,1563380696,1563382496,1563384296,1563386096,1563387896,
                1563389696,1563391496,1563393296,1563395096,1563396896,1563398696]
}
```

### Generate text

The API also allows you to request a sentence consisting of text generated by another 
neural network I developed, which can be accessed at 
`http://www.votepredictor.com/api/predict/generate`.

The only input required is the text that the neural network will use to generate a sentence.
Here is an example CURL request:

```bash
curl -X POST http://www.votepredictor.com/api/generate
--data "{\"text\": \"Hi \"}"
--header "Content-Type: application/json"
```

Here is an example response:

```json
{
    "generated_text":"Hi this is generated text."
}
```

## Future work

* I plan to have this tool automatically update the neural network with new comments on 
reddit so it can continue to learn.
* I plan to create a chrome plugin that automatically informs users of the tool's 
prediction when they write a top-level comment on Reddit.
